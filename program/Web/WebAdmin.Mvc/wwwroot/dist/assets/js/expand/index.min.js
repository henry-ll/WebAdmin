jQuery(function () {
    // 选项卡
    $('#iframe-content').multitabs({
        iframe: true,
        cache: true,
        refresh: 'no',  // iframe中页面是否刷新，'no'：'从不刷新'，'nav'：'点击菜单刷新'，'all'：'菜单和tab点击都刷新'
        nav: {
            backgroundColor: 'transparent',
        },
        init: [
            {
                type: 'main',
                title: '首页',
                url: $('.default-page').attr('data-href') || '/Home/Page'
            },
        ]
    });

    // 读取cookie中的主题设置
    var the_logo_bg = $.cookie('the_logo_bg'),
        the_header_bg = $.cookie('the_header_bg'),
        the_sidebar_bg = $.cookie('the_sidebar_bg'),
        the_site_theme = $.cookie('the_site_theme');

    if (the_logo_bg) $('body').attr('data-logobg', the_logo_bg);
    if (the_header_bg) $('body').attr('data-headerbg', the_header_bg);
    if (the_sidebar_bg) $('body').attr('data-sidebarbg', the_sidebar_bg);
    if (the_site_theme) {
        $('body').attr('data-theme', the_site_theme);

        $.each($(".tab-pane"), function (i, v) {
            var $v = $(v);
            if (!v.addEventListener) {
                a.attachEvent('onload', function () {
                    $v.contents().find('body').attr('data-theme', the_site_theme);
                });
            }
            v.addEventListener('load', function () {
                $v.contents().find('body').attr('data-theme', the_site_theme);
            }, true);
        });
    }

    // 处理主题配色下拉选中
    $(".dropdown-skin :radio").each(function () {
        var $this = $(this),
            radioName = $this.attr('name');
        switch (radioName) {
            case 'site_theme':
                $this.val() == the_site_theme && $this.prop("checked", true);
                break;
            case 'logo_bg':
                $this.val() == the_logo_bg && $this.prop("checked", true);
                break;
            case 'header_bg':
                $this.val() == the_header_bg && $this.prop("checked", true);
                break;
            case 'sidebar_bg':
                $this.val() == the_sidebar_bg && $this.prop("checked", true);
        }
    });

    // 设置主题配色
    setTheme = function (input_name, data_name) {
        $("input[name='" + input_name + "']").click(function () {
            var check_theme = $(this).val();
            $('body').attr(data_name, check_theme);
            $.cookie('the_' + input_name, $(this).val());
            if (input_name == 'site_theme') {
                $.each($(".tab-pane"), function (i, v) {
                    $(v).contents().find('body').attr('data-theme', check_theme);
                });
            }
        });
    }
    setTheme('site_theme', 'data-theme');
    setTheme('sidebar_bg', 'data-sidebarbg');
    setTheme('logo_bg', 'data-logobg');
    setTheme('header_bg', 'data-headerbg');

    // 回调主题配色
    callbackTheme = function ($v, callback) {
        $v.contents().find('body').attr('data-theme', $.cookie('the_site_theme'));
        if (typeof callback === 'function') {
            setTimeout(callback, 200);
        }
    };

    // 菜单选中
    $(document).on('click', '.nav-item .multitabs', function () {
        $('.nav-item').removeClass('active');
        $('.nav-subnav li').removeClass('active');
        $(this).parent('li').addClass('active');
        $(this).parents('.nav-item-has-subnav').addClass('open').first().addClass('active');
    });
});